{% raw -%}
    worker_init: |
      # single_model_launch.sh
      # Source the common script
      source /home/openinference_svc/sophia_common_scripts.sh   # Replace with the actual path to common.sh
      # Setup the environment
      setup_environment_infinity
      # Define model parameters
      framework="infinity"
      cluster="sophia"
      model_name="nvidia/NV-Embed-v2"
      model_command="infinity_emb v2 --host 127.0.0.1 --port 8000 --model-id ${model_name} --device cuda --trust-remote-code --batch-size 8 --dtype bfloat16"
      log_file="$PWD/logfile_sophia_vllm_${model_name}_$(hostname).log"


      # Initialize retry counter for the model
      retry_counter_model_1=0

      # Start the model
      while true; do
          echo "Starting models sequence..."
          if ! start_model "$model_name" "$model_command" "$log_file" retry_counter_model_1; then
              continue  # Restart from the beginning if this fails
          fi
          echo "All models started successfully."
          break
      done
{% endraw %}